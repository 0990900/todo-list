<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Todo List</title>
  <script type="text/javascript" src="js/core.js"></script>
  <script type="text/javascript" src="js/modules.js"></script>
  <link rel="stylesheet" href="css/style.css"/>
  <script type="text/javascript">
    require(['func', 'option', 'pubsub', 'todolist'], function (f, Option, PubSub, TodoList) {
      window.onloadafter(() => {
        f.compose(Option.of, document.byId)('todo-input')
          .tab(el => {
            el.addEventListener('keydown', e => {
              if (!e.isComposing && e.key === 'Enter') {
                PubSub.publish('todo:append', el.value);
                el.value = "";
              }
            });
          })
          .tab(el => el.focus());
        f.compose(Option.of, document.byId)('todo-list')
          .tab(el => {
            el.addEventListener('click', event => {
              if (event.target.type === 'checkbox') {
                PubSub.publish('todo:toggle', event.target.id, event.target.checked);
              } else if (event.target.tagName === "A" && event.target.getAttribute("action") === "remove") {
                PubSub.publish('todo:remove', event.target.getAttribute("for"));
              }
            });
          });
        TodoList.of('todo-list', () => {
          f.compose(Option.of, document.byId)('todo-input')
            .tab(el => el.focus());
        });
      });
    });
  </script>
</head>
<body>
<div>
  <label for="todo-input"></label>
  <input type="text" id="todo-input" placeholder="어떤 일을 해야 하나요?">
</div>
<div id="todo-list"></div>
</body>
</html>
