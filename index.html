<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Todo List</title>
  <script type="text/javascript" src="js/core.js"></script>
  <script type="text/javascript" src="js/modules.js"></script>
  <link rel="stylesheet" href="css/style.css"/>
  <script type="text/javascript">
    require(['func', 'option', 'pubsub', 'todolist'], function (f, Option, PubSub, TodoList) {
      const elementOption = elId => f.compose(Option.of, document.byId)(elId);
      window.onloadafter(() => {
        const $input = elementOption('todo-input');
        const $todolist = elementOption('todo-list');
        TodoList.of($todolist, () => $input.tab(el => el.focus()));

        // handle event
        $input.tab(el => {
          el.addEventListener('keydown', e => {
            if (!e.isComposing && e.key === 'Enter') {
              PubSub.publish('todo:append', el.value);
              el.value = "";
            }
          });
        }).tab(el => el.focus());

        $todolist.tab(el => {
          el.addEventListener('click', event => {
            event.preventDefault();
            if (event.target.type === 'checkbox') {
              PubSub.publish('todo:toggle', event.target.id, event.target.checked);
            } else if (event.target.tagName === "A" && event.target.getAttribute("action") === "remove") {
              PubSub.publish('todo:remove', event.target.getAttribute("for"));
            }
          });
        });
      });
    });
  </script>
</head>
<body>
<div>
  <label for="todo-input"></label>
  <input type="text" id="todo-input" placeholder="어떤 일을 해야 하나요?">
</div>
<div id="todo-list"></div>
</body>
</html>
